apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: lint
  labels:
    app.kubernetes.io/version: "1.0"
  annotations:
    tekton.dev/displayName: "Linting Task"
    tekton.dev/pipelines.minVersion: "0.17.0"
spec:
  description: >-
    This task runs flake8 linting on Python code
  workspaces:
    - name: source
      description: The workspace containing the source code
  params:
    - name: image
      description: The Python image to use for linting
      type: string
      default: "python:3.11-slim"
    - name: args
      description: Arguments for flake8
      type: string
      default: "--count --max-complexity=10 --max-line-length=120 --statistics"
  steps:
    - name: lint
      image: $(params.image)
      workingDir: $(workspaces.source.path)
      script: |
        #!/bin/bash
        set -e
        echo "Installing flake8..."
        pip install --quiet flake8
        echo "Running flake8 linting..."
        flake8 service/ $(params.args)
        echo "Linting completed successfully!"

